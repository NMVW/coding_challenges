{"version":3,"file":"index.es.js","sources":["../src/index.js"],"sourcesContent":["import { useEffect } from 'react';\n\nconst BASE_FINCH_CONNECT_URI = 'https://connect.tryfinch.com';\nconst DEFAULT_FINCH_REDIRECT_URI = 'https://tryfinch.com';\nconst FINCH_CONNECT_IFRAME_ID = 'finch-connect-iframe';\nconst FINCH_AUTH_MESSAGE_NAME = 'finch-auth-message';\n\nconst noop = () => {};\n\n// eslint-disable-next-line import/prefer-default-export\nexport const useFinchConnect = (options = {}) => {\n  const {\n    clientId,\n    products = [],\n    mode = 'employer',\n    manual = false,\n    payrollProvider = null,\n    onSuccess = noop,\n    onError = noop,\n    onClose = noop,\n  } = options;\n\n  const _constructAuthUrl = (clientId, products) => {\n    const authUrl = new URL(`${BASE_FINCH_CONNECT_URI}/authorize`);\n\n    if (clientId) authUrl.searchParams.append('client_id', clientId);\n    if (payrollProvider) authUrl.searchParams.append('payroll_provider', payrollProvider);\n    authUrl.searchParams.append('products', products.join(' '));\n    authUrl.searchParams.append('app_type', 'spa');\n    authUrl.searchParams.append('redirect_uri', DEFAULT_FINCH_REDIRECT_URI);\n    authUrl.searchParams.append('mode', mode);\n    if (manual) authUrl.searchParams.append('manual', manual);\n\n    return authUrl.href;\n  };\n\n  const open = () => {\n    if (document.getElementById(FINCH_CONNECT_IFRAME_ID)) {\n      return null;\n    }\n\n    const iframe = document.createElement('iframe');\n    iframe.src = _constructAuthUrl(clientId, products);\n    iframe.frameBorder = '0';\n    iframe.id = FINCH_CONNECT_IFRAME_ID;\n    iframe.style.position = 'fixed';\n    iframe.style.zIndex = '999';\n    iframe.style.height = '100%';\n    iframe.style.width = '100%';\n    iframe.style.top = '0';\n    iframe.style.backgroundColor = 'none transparent';\n    iframe.style.border = 'none';\n    document.body.prepend(iframe);\n    document.body.style.overflow = 'hidden';\n  };\n\n  const close = () => {\n    const frameToRemove = document.getElementById(FINCH_CONNECT_IFRAME_ID);\n    if (frameToRemove) {\n      frameToRemove.parentNode.removeChild(frameToRemove);\n      document.body.style.overflow = 'inherit';\n    }\n  };\n\n  useEffect(() => {\n    function handleFinchAuth(event) {\n      const handleFinchAuthSuccess = (code) => onSuccess({ code });\n      const handleFinchAuthError = (error) => onError({ errorMessage: error });\n      const handleFinchAuthClose = () => onClose();\n\n      if (!event.data) return;\n      if (event.data.name !== FINCH_AUTH_MESSAGE_NAME) return;\n      if (!event.origin.startsWith(BASE_FINCH_CONNECT_URI)) return;\n\n      const { code, error, closed } = event.data;\n\n      close();\n      if (code) handleFinchAuthSuccess(code);\n      else if (error) handleFinchAuthError(error);\n      else if (closed) handleFinchAuthClose();\n    }\n\n    window.addEventListener('message', handleFinchAuth);\n    return () => window.removeEventListener('message', handleFinchAuth);\n  }, [onClose, onError, onSuccess]);\n\n  return {\n    open,\n  };\n};\n"],"names":["BASE_FINCH_CONNECT_URI","DEFAULT_FINCH_REDIRECT_URI","FINCH_CONNECT_IFRAME_ID","FINCH_AUTH_MESSAGE_NAME","noop","useFinchConnect","options","clientId","products","mode","manual","payrollProvider","onSuccess","onError","onClose","_constructAuthUrl","authUrl","URL","searchParams","append","join","href","open","document","getElementById","iframe","createElement","src","frameBorder","id","style","position","zIndex","height","width","top","backgroundColor","border","body","prepend","overflow","close","frameToRemove","parentNode","removeChild","useEffect","handleFinchAuth","event","handleFinchAuthSuccess","code","handleFinchAuthError","error","errorMessage","handleFinchAuthClose","data","name","origin","startsWith","closed","window","addEventListener","removeEventListener"],"mappings":"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"}